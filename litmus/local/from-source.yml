version: "2"

services:
  owncloud:
    image: owncloud/base:latest
    volumes:
      - ${TESTING_PATH}:/var/www/owncloud
    ports:
      - ${TESTING_PORT}:80
    links:
      - db:db
    environment:
      - OWNCLOUD_DOMAIN=owncloud
      - OWNCLOUD_DB_TYPE=mysql
      - OWNCLOUD_DB_NAME=owncloud
      - OWNCLOUD_DB_USERNAME=owncloud
      - OWNCLOUD_DB_PASSWORD=p455w0rd
      - OWNCLOUD_DB_HOST=db
      - OWNCLOUD_ADMIN_USERNAME=admin
      - OWNCLOUD_ADMIN_PASSWORD=admin

  db:
    image: mysql:5
    expose:
      - 3306
    environment:
      - MYSQL_ROOT_PASSWORD=p455w0rd
      - MYSQL_DATABASE=owncloud
      - MYSQL_USER=owncloud
      - MYSQL_PASSWORD=p455w0rd

  litmus:
    image: owncloud/litmus:${TESTING_LITMUS}
    entrypoint: ["/bin/sleep", "86400"]
    environment:
      - LITMUS_URL=http://owncloud/remote.php/webdav
      - LITMUS_USERNAME=admin
      - LITMUS_PASSWORD=admin
      - LITMUS_WAIT=true
      - LITMUS_CHECK_URL=http://owncloud/status.php
    links:
      - owncloud:owncloud
